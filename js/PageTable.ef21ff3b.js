import{P as L,r as M,t as j,B as S,u as H,c as Q,y as Y,a as x,o as G,I as J,H as K,_ as W,f as p,g,h as b,j as u,k as o,w as t,F as X,q as d,l as i,Q as E,p as T,R as Z,T as $,U as ee}from"./index.a1f9718e.js";const oe={components:{PlusOutlined:L},setup(){const e=M({total:0,iva:0,re:0,total_euros:0,dto:0,ante_euro:0,isRe:!1,isIva:!1,add_producto:!1,cantidad:"",codigo:"",precio:"",articulo:"",isEdit:""}),c=j(e),B=S({get:()=>e.dto===0?"":e.dto,set:a=>{e.dto=a===""?0:Number(a)}}),l=H(),v=Q(),{t:w}=Y(),r=x([]),y=S(()=>r.value.length+1),n=x(!1),_=x([]),h=()=>{e.isRe=!e.isRe,f()},I=()=>{e.isIva=!e.isIva,f()},f=()=>{console.log("[PageTable]funcion calcula"),e.total=0;for(const a of r.value)e.total+=a.euros;e.dto<0&&(e.dto=0),e.isIva?e.iva=Number((e.total*(100-e.dto)*.01*.21).toFixed(2)):e.iva=0,e.isRe?e.re=Number((e.total*(100-e.dto)*.01*.052).toFixed(2)):e.re=0,e.total_euros=Number((e.total*(100-e.dto)*.01+e.iva+e.re).toFixed(2))},F=()=>{r.value=new Array,e.total=0,f()},P=()=>{e.add_producto=!0,e.isEdit="",e.cantidad="",e.codigo="",e.precio="",e.articulo=""},C=a=>{e.add_producto=!0,e.cantidad=a.cantidad,e.precio=a.precio,e.codigo=a.codigo,e.articulo=a.articulo,e.isEdit=a.key,e.ante_euro=a.euros},m=a=>{e.add_producto=!1,e.isEdit="",e.cantidad="",e.codigo="",e.precio="",e.articulo="",r.value=r.value.filter(k=>k.codigo!==a),f()},N=()=>{if(n.value=!0,e.isEdit!=""){for(const a of r.value)if(a.key===e.isEdit){a.cantidad=e.cantidad,a.precio=Number(e.precio).toFixed(2),a.codigo=e.codigo,a.articulo=e.articulo,a.euros=Number(e.cantidad)*Number(e.precio);break}e.isEdit=""}else{const a={key:`${y.value}`,cantidad:e.cantidad,codigo:e.codigo,precio:Number(e.precio).toFixed(2),articulo:e.articulo,euros:Number((Number(e.cantidad)*Number(e.precio)).toFixed(2))};r.value.push(a)}e.add_producto=!1,f(),e.cantidad="",e.codigo="",e.precio="",e.articulo="",console.log("[PageTable]producto saved"),n.value=!1},A=()=>{v.state.isVisitor?K().then(a=>{console.log("[PageTable]articulo en base de dato:",a),a.forEach(k=>{_.value.push({value:k.name})})}):J("articulos").then(a=>{console.log("[PageTable]articulo en FireBase:",a),a.forEach(k=>{_.value.push({value:k.name})})}).catch(a=>{console.error("Error getting data: ",a)})},R=()=>{e.precio=e.precio.replace(/,|，/g,".")},s=()=>{e.precio=e.precio.replace(/[^0-9.,，]/g,"")},D=()=>{e.precio=e.precio.replace(/[^0-9]/g,"")},U=()=>{console.log("[PageTable]funcion pageUpdate"),A(),f(),z()},V=()=>{U(),l.push({name:"pdf",params:{history:0}})},z=()=>{v.commit("saveData",{dataArray:r.value,euroBase:e.total.toFixed(2),dto:e.dto,isRe:e.isRe,isIva:e.isIva}),v.commit("saveFinal",{total:e.total.toFixed(2),dto:e.dto,base:(e.total-e.dto).toFixed(2),iva:e.iva.toFixed(2),re:e.re.toFixed(2),total_final:e.total_euros.toFixed(2)})},q=()=>{z(),l.back()};return G(()=>{console.log("[PageTable]funcion onMounted"),e.dto=v.state.dto,r.value=v.state.dataArray,e.total=v.state.euroBase,e.isRe=v.state.isRe,e.isIva=v.state.isIva,f(),U()}),{...c,t:w,displayDto:B,dataSource:r,checkIva:I,checkRe:h,calcula:f,goBack:q,addProducto:P,saveProducto:N,deleteProducto:m,editProducto:C,clearTable:F,checkInput:R,validatePrecioInput:s,validateNumberInput:D,confirmLoading:n,goPdf:V,articulo_list:_}}};const O=e=>($("data-v-a912e77e"),e=e(),ee(),e),te={class:"button-container"},ae={style:{"margin-left":"0"}},le=O(()=>u("div",{class:"space"},null,-1)),se={key:0},ne={key:1},ie={key:2},de={key:3},ce=O(()=>u("div",{class:"space"},null,-1)),re={class:"large-font"},ue={class:"item-row"},pe=["onClick"],_e={class:"list-font"},fe={class:"button-container"};function ve(e,c,B,l,v,w){const r=p("a-button"),y=p("a-input-number"),n=p("a-col"),_=p("a-row"),h=p("a-checkbox"),I=p("a-collapse-panel"),f=p("a-collapse"),F=p("PlusOutlined"),P=p("a-list-item"),C=p("a-list"),m=p("a-input"),N=p("a-select"),A=p("a-popconfirm"),R=p("a-modal");return g(),b(X,null,[u("div",te,[o(r,{onClick:l.goBack,class:"btn-back",size:"large"},{default:t(()=>[d(i(e.$t("back")),1)]),_:1},8,["onClick"]),o(r,{onClick:l.goPdf,class:"btn-next",size:"large"},{default:t(()=>[d(i(e.$t("next")),1)]),_:1},8,["onClick"])]),o(f,{bordered:!1,class:"collapse-total"},{default:t(()=>[o(I,null,{header:t(()=>[u("div",ae,[u("span",null,i(e.$t("total_euro")),1)]),le,u("div",null,[e.isIva?(g(),b("div",se,"con iva")):(g(),b("div",ne,"sin iva")),e.isRe?(g(),b("div",ie,"con re")):(g(),b("div",de,"sin re"))]),ce,u("div",re,[u("span",null,i(e.total_euros.toFixed(2))+"€",1)])]),default:t(()=>[o(_,{gutter:16},{default:t(()=>[o(n,{xs:18,sm:12,md:12,lg:6},{default:t(()=>[o(y,{size:"small",style:{"padding-bottom":"8px"},value:l.displayDto,"onUpdate:value":c[0]||(c[0]=s=>l.displayDto=s),onChange:l.calcula,"addon-before":"DTO",min:0,max:99},{default:t(()=>[d("%")]),_:1},8,["value","onChange"])]),_:1})]),_:1}),o(_,null,{default:t(()=>[o(n,{span:12},{default:t(()=>[d("  Total:")]),_:1}),o(n,{span:12,class:"text-right"},{default:t(()=>[d(i(e.total.toFixed(2)),1)]),_:1})]),_:1}),e.dto>0?(g(),E(_,{key:0},{default:t(()=>[o(n,{span:12},{default:t(()=>[d("  "+i(e.dto)+"%DTO:",1)]),_:1}),o(n,{span:12,class:"text-right"},{default:t(()=>[d(" -"+i(Number(e.total*.01*e.dto).toFixed(2)),1)]),_:1})]),_:1})):T("",!0),o(_,null,{default:t(()=>[o(n,{span:12},{default:t(()=>[d("  "),o(h,{checked:e.isIva,onClick:l.checkIva},{default:t(()=>[d("+21%IVA")]),_:1},8,["checked","onClick"])]),_:1}),o(n,{span:12,class:"text-right"},{default:t(()=>[d(i(e.iva.toFixed(2)),1)]),_:1})]),_:1}),o(_,null,{default:t(()=>[o(n,{span:12},{default:t(()=>[d("  "),o(h,{checked:e.isRe,onClick:l.checkRe},{default:t(()=>[d("+5.2%R.E.")]),_:1},8,["checked","onClick"])]),_:1}),o(n,{span:12,class:"text-right"},{default:t(()=>[d(i(e.re.toFixed(2)),1)]),_:1})]),_:1})]),_:1})]),_:1}),o(_,null,{default:t(()=>[o(n,{span:24},{default:t(()=>[o(r,{onClick:l.addProducto,class:"btn-add",type:"text",block:""},{icon:t(()=>[o(F,{style:{"font-size":"20px"}})]),_:1},8,["onClick"]),o(C,{class:"a-list","item-layout":"horizontal","data-source":l.dataSource,locale:{emptyText:" "}},{renderItem:t(({item:s})=>[o(P,null,{default:t(()=>[u("div",ue,[u("a",{class:"item-details",onClick:D=>l.editProducto(s)},[u("div",null,[u("div",null,i(s.codigo)+", "+i(s.articulo),1),u("div",null,i(s.cantidad)+" x "+i(Number(s.precio).toFixed(2))+" €",1)]),u("div",_e,i(Number(s.euros).toFixed(2))+" €",1)],8,pe)])]),_:2},1024)]),_:1},8,["data-source"])]),_:1})]),_:1}),o(R,{visible:e.add_producto,"onUpdate:visible":c[6]||(c[6]=s=>e.add_producto=s),title:"add","confirm-loading":l.confirmLoading,onOk:l.saveProducto},{footer:t(()=>[u("div",fe,[e.isEdit!=""?(g(),E(A,{key:0,title:"Are you sure delete this task?","ok-text":"Yes","cancel-text":"No",onConfirm:c[5]||(c[5]=s=>l.deleteProducto(e.codigo))},{default:t(()=>[e.isEdit!=""?(g(),E(r,{key:0,size:"large",type:"primary",danger:""},{default:t(()=>[d(i(e.$t("delect")),1)]),_:1})):T("",!0)]),_:1})):T("",!0),o(r,{class:Z([{"center-button":e.isEdit==""},"btn-normal"]),key:"submit",type:"primary",size:"large",onClick:l.saveProducto},{default:t(()=>[d(i(e.$t("save")),1)]),_:1},8,["class","onClick"])])]),default:t(()=>[o(_,null,{default:t(()=>[o(n,{span:5},{default:t(()=>[d(i(e.$t("cantidad"))+"：",1)]),_:1}),o(n,{span:17},{default:t(()=>[o(m,{value:e.cantidad,"onUpdate:value":c[1]||(c[1]=s=>e.cantidad=s),class:"text-right",spellcheck:"false",onInput:l.validateNumberInput},null,8,["value","onInput"])]),_:1})]),_:1}),o(_,null,{default:t(()=>[o(n,{span:5},{default:t(()=>[d(i(e.$t("precio"))+":",1)]),_:1}),o(n,{span:17},{default:t(()=>[o(m,{value:e.precio,"onUpdate:value":c[2]||(c[2]=s=>e.precio=s),class:"text-right",spellcheck:"false",onBlur:l.checkInput,onInput:l.validatePrecioInput},null,8,["value","onBlur","onInput"])]),_:1})]),_:1}),o(_,null,{default:t(()=>[o(n,{span:5},{default:t(()=>[d(i(e.$t("codigo"))+":",1)]),_:1}),o(n,{span:17},{default:t(()=>[o(m,{value:e.codigo,"onUpdate:value":c[3]||(c[3]=s=>e.codigo=s),class:"text-right",spellcheck:"false"},null,8,["value"])]),_:1})]),_:1}),o(N,{value:e.articulo,"onUpdate:value":c[4]||(c[4]=s=>e.articulo=s),"show-search":"",placeholder:"Select",style:{width:"100%"},options:l.articulo_list},null,8,["value","options"])]),_:1},8,["visible","confirm-loading","onOk"])],64)}const me=W(oe,[["render",ve],["__scopeId","data-v-a912e77e"]]);export{me as default};
