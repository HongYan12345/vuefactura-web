import{s as $,Z as A,z as T,$ as I,S as J,r as V,t as R,a as N,y as j,u as z,c as H,B as D,o as M,I as P,a0 as q,M as U,k as o,L as Z,a1 as G,E as K,_ as Q,f as l,g as F,h as E,j as i,w as d,q as b,l as w}from"./index.a1f9718e.js";const W=$({components:{CopyOutlined:A,DeleteOutlined:T,LoadingOutlined:I,SearchOutlined:J},setup(){const t=V({isLoading:!0}),p=R(t),u=N(""),{t:L}=j(),f=z(),r=H(),n=N([]),_=D(()=>u.value?n.value.filter(e=>e.factura_date.includes(u.value)||e.factura_num.toString().includes(u.value)||JSON.parse(e.user).name.includes(u.value)):n.value),m=()=>{n.value=[],r.state.isVisitor?q().then(e=>{console.log("[PageHistory]factura en base de dato:",e),e.forEach(a=>{n.value.push(a)}),t.isLoading=!1}):P("facturas").then(e=>{console.log("[PageHistory]factura en FireBase:",e),e.forEach(a=>{n.value.push(a)}),t.isLoading=!1}).catch(e=>{console.error("Error getting data: ",e)})},O=D(()=>[..._.value].sort((a,s)=>{const h=new Date(a.factura_date.split("/").reverse().join("-")).getTime(),C=new Date(s.factura_date.split("/").reverse().join("-")).getTime();return h==C?Number(s.factura_num)-Number(a.factura_num):C-h})),k=()=>{S(),f.back()},S=()=>{r.commit("RESET_STATE")},v=e=>{const a=JSON.parse(e.empresa),s=JSON.parse(e.euro_final),h=JSON.parse(e.item_list),C=JSON.parse(e.user);console.log(s),r.commit("saveCliente",C),r.commit("saveData",{dataArray:h,euroBase:s.total,dto:s.dto,isRe:s.re!=0,isIva:s.iva!=0}),r.commit("saveFinal",s),r.commit("saveEmpresa",a),r.commit("saveNum",{num:e.factura_num,date:e.factura_date,forma:e.forma})},y=e=>{v(e),f.push({name:"pdf",params:{history:1}})},c=e=>{v(e),f.push({name:"company"})},g=e=>{U.confirm({title:()=>"Do you want to delete these items?",icon:()=>o(Z),content:()=>"",onOk(){G(e.id).then(a=>{console.log("delect success",a),r.state.isVisitor||K("facturas",e.factura_num+e.factura_date.split("/")[2]).then(s=>{console.log("delect success",s),m()}).catch(s=>{console.error("Error getting data: ",s)})}).catch(a=>{console.error("Error getting data: ",a)})},onCancel(){}})},B=e=>{const a=JSON.parse(e.user);return"Nº: "+e.factura_num+", "+e.factura_date+", "+a.name};return M(()=>{m()}),{...p,t:L,factura_list:n,goBack:k,parsedItem:B,goFactura:y,newFactura:c,sortedFacturaList:O,deletFactura:g,filteredClients:_,searchString:u}}}),X={class:"button-container"},Y={key:0},x={key:1},ee={class:"item-row"},te=["onClick"];function ae(t,p,u,L,f,r){const n=l("a-button"),_=l("LoadingOutlined"),m=l("SearchOutlined"),O=l("a-input"),k=l("CopyOutlined"),S=l("DeleteOutlined"),v=l("a-list-item"),y=l("a-list");return F(),E("div",null,[i("div",X,[o(n,{onClick:t.goBack,class:"btn-back",size:"large"},{default:d(()=>[b(w(t.$t("back")),1)]),_:1},8,["onClick"])]),t.isLoading?(F(),E("div",Y,[i("div",null,[o(_)])])):(F(),E("div",x,[i("div",null,[o(O,{class:"search-input",placeholder:"Search",value:t.searchString,"onUpdate:value":p[0]||(p[0]=c=>t.searchString=c)},{suffix:d(()=>[o(m)]),_:1},8,["value"])]),o(y,{class:"a-list","item-layout":"horizontal","data-source":t.sortedFacturaList,locale:{emptyText:" "}},{renderItem:d(({item:c})=>[o(v,null,{default:d(()=>[i("div",ee,[i("a",{class:"item-details",onClick:g=>t.goFactura(c)},[i("div",null,[i("div",null,w(t.parsedItem(c)),1)])],8,te),o(n,{onClick:g=>t.newFactura(c)},{default:d(()=>[o(k)]),_:2},1032,["onClick"]),b("   "),o(n,{onClick:g=>t.deletFactura(c)},{default:d(()=>[o(S)]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},8,["data-source"])]))])}const oe=Q(W,[["render",ae]]);export{oe as default};
